{
    "name": "new_request",
    "description": "Fluxo Ãºnico de request 2.0",
    "blueprint_spec": {
        "lanes": [
            {
                "id": "BOT_X_BACKOFFICE",
                "name": "BOT_X_BACKOFFICE",
                "rule": [
                    "fn",
                    [
                        "actor_data",
                        "bag"
                    ],
                    [
                        "or",
                        [
                            "eval",
                            [
                                "apply",
                                "or",
                                [
                                    "map",
                                    [
                                        "fn",
                                        [
                                            "v"
                                        ],
                                        [
                                            "or",
                                            [
                                                "=",
                                                "v",
                                                [
                                                    "`",
                                                    "adminRequests"
                                                ]
                                            ],
                                            [
                                                "=",
                                                "v",
                                                [
                                                    "`",
                                                    "botGeneral"
                                                ]
                                            ],
                                            [
                                                "=",
                                                "v",
                                                [
                                                    "`",
                                                    "botRealtor"
                                                ]
                                            ],
                                            [
                                                "=",
                                                "v",
                                                [
                                                    "`",
                                                    "botLead"
                                                ]
                                            ]
                                        ]
                                    ],
                                    [
                                        "get",
                                        "actor_data",
                                        [
                                            "`",
                                            "claims"
                                        ]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            },
            {
                "id": "B",
                "name": "BackOffice",
                "rule": [
                    "fn",
                    [
                        "actor_data",
                        "bag"
                    ],
                    [
                        "eval",
                        [
                            "apply",
                            "or",
                            [
                                "map",
                                [
                                    "fn",
                                    [
                                        "v"
                                    ],
                                    [
                                        "=",
                                        "v",
                                        [
                                            "`",
                                            "adminRequests"
                                        ]
                                    ]
                                ],
                                [
                                    "get",
                                    "actor_data",
                                    [
                                        "`",
                                        "claims"
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            }
        ],
        "nodes": [
            {
                "id": "SA",
                "name": "Start Request Workflow",
                "next": "PARTY-NUMBER-CHECK-1",
                "type": "Start",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input_schema": {
                        "type": "object",
                        "required": [
                            "party_number"
                        ],
                        "properties": {
                            "requested": {
                                "type": "boolean"
                            },
                            "party_number": {
                                "type": "string"
                            },
                            "realtor_number": {
                                "type": "string"
                            }
                        },
                        "additionalProperties": false
                    }
                }
            },
            {
                "id": "PARTY-NUMBER-CHECK-1",
                "name": "Check if the party number length has 12 characters or 13 and put the number 9 if is necessary.",
                "next": "PARTY-NUMBER-CHECK-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/validate-whatsapp/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "PARTY-NUMBER-CHECK-2",
                "name": "Set whatsapp validation to party number",
                "next": "ST21-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "party_number": {
                            "$ref": "result.data.mobile_phone"
                        }
                    }
                }
            },
            {
                "id": "ST21-L",
                "name": "get chat or create if not exist",
                "next": "FLOW-CHAT",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat_by_buyer_mobile_phone/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FLOW-CHAT",
                "name": "Check if profile is an Realtor after check phone_number.",
                "next": {
                    "REALTOR": "ST22-L",
                    "default": "SB10-G"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.role"
                        }
                    }
                }
            },
            {
                "id": "SB10-G",
                "name": "Set chat_id and chat_participant_id (buyer)",
                "next": "SB12-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "result.data.chat_id"
                        },
                        "buyer_chat_participant_id": {
                            "$ref": "result.data.buyer_chat_participant_id"
                        }
                    }
                }
            },
            {
                "id": "SB12-G",
                "name": "get chat details and messages by chat ID.",
                "next": "SB13-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB13-G",
                "name": "Save messages history to bag.",
                "next": "ST22-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "ST22-L",
                "name": "get bot phone number",
                "next": "SB11-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/bot-phone-number"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB11-G",
                "name": "Set bot phone number to bag.",
                "next": "ST4-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "bot_phone_number": {
                            "$ref": "result.data.bot_phone_number"
                        }
                    }
                }
            },
            {
                "id": "ST4-G",
                "name": "Get account settings",
                "next": "SB2-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/accounts"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB2-G",
                "name": "Save default claims to bag, account_id and files phrases",
                "next": "F1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "account_id": {
                            "$ref": "result.data[0].id"
                        },
                        "default_claims": {
                            "$ref": "result.data[0].settings.default_user_claims"
                        }
                    }
                }
            },
            {
                "id": "F1",
                "name": "Check how process started",
                "next": {
                    "true": "OLD-BUYER",
                    "default": "U1-G"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.requested"
                        }
                    }
                }
            },
            {
                "id": "U1-G",
                "name": "Capturing first message content",
                "next": "SB8-G",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_FIRST_MESSAGE"
                }
            },
            {
                "id": "SB8-G",
                "name": "Set number to bag",
                "next": "ST21-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "buyer_number": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "ST21-G",
                "name": "Validate Phone Number",
                "next": "SB9-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.buyer_number}}/phone-number-validator"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB9-G",
                "name": "Check first message response",
                "next": "ST18-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "is_phone_number": {
                            "$ref": "result.data.is_valid"
                        }
                    }
                }
            },
            {
                "id": "ST18-L",
                "name": "Get Profile",
                "next": "F10-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "F10-L",
                "name": "Check if profile is an Realtor after check phone_number.",
                "next": {
                    "REALTOR": "F4",
                    "default": "ST19-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.role"
                        }
                    }
                }
            },
            {
                "id": "F4",
                "name": "Check if first message content is a telephone number",
                "next": {
                    "true": "ST16-R",
                    "default": "U16-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.is_phone_number"
                        }
                    }
                }
            },
            {
                "id": "U16-L",
                "name": "Notify realtor",
                "next": "EXIT-REALTOR-INVALID-PHONE-NUMBER",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: OlÃ¡ Corretor, para que eu possa te ajudar, preciso que vocÃª envie um nÃºmero de um cliente para eu entrar em contato. O nÃºmero deve ser enviado nesse formato XXXXXXXXXXX , sendo 2 dÃ­gitos do ddd e 9 do nÃºmero. Ex: 21999998888. Obrigada! =)",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_REALTOR_SHOULD_SEND_CLIENT_TELEPHONE",
                    "timeout": 1
                }
            },
            {
                "id": "EXIT-REALTOR-INVALID-PHONE-NUMBER",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "ST19-L",
                "name": "Get request",
                "next": "ST19-L-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/requests?id=eq.{{result.data.current_request_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "ST19-L-A1",
                "name": "Set request to bag",
                "next": "F8-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$ref": "result.data[0]"
                        }
                    }
                }
            },
            {
                "id": "F8-L",
                "name": "User already has an approved request?",
                "next": {
                    "default": "OLD-BUYER",
                    "APPROVED": "EXIT-REQUEST-APPROVED",
                    "DOCUMENTS_RECEIVED": "U15-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.request.status"
                        }
                    }
                }
            },
            {
                "id": "U14-L",
                "name": "Notify user his last request was approved",
                "next": "ST36-L",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: *ParabÃ©ns*! SEU crÃ©dito foi *APROVADO*!!\nJÃ¡ pode preparar a Festa! ðŸŽ‰\n\nMuito em breve um de nossos colaboradores irÃ¡ entrar em contato com vocÃª, ok?\n\nPara visualizar as opÃ§Ãµes de empreendimentos que selecionamos para vocÃª Ã© sÃ³ baixar o APP Approva FÃ¡cil atravÃ©s do link\nhttps://play.google.com/store/apps/details?id=com.aprovafacil\nOBS:Caso esteja com o APP instalado no celular e aberto, por favor, feche e abra novamente",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_REQUEST_ALREADY_APPROVED",
                    "timeout": 1
                }
            },
            {
                "id": "ST36-L",
                "name": "Save message on entity message from NOTIFY_REQUEST_ALREADY_APPROVED.",
                "next": "ST40-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: *ParabÃ©ns*! SEU crÃ©dito foi *APROVADO*!!\nJÃ¡ pode preparar a Festa! ðŸŽ‰\n\nMuito em breve um de nossos colaboradores irÃ¡ entrar em contato com vocÃª, ok?\n\nPara visualizar as opÃ§Ãµes de empreendimentos que selecionamos para vocÃª Ã© sÃ³ baixar o APP Approva FÃ¡cil atravÃ©s do link\nhttps://play.google.com/store/apps/details?id=com.aprovafacil\nOBS:Caso esteja com o APP instalado no celular e aberto, por favor, feche e abra novamente",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "ST40-L",
                "name": "get chat details and messages by chat ID.",
                "next": "SB15-G",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB15-G",
                "name": "Save messages history to bag.",
                "next": "EXIT-REQUEST-APPROVED",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "EXIT-REQUEST-APPROVED",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "U15-L",
                "name": "Notify user his documents are under analysis",
                "next": "ST23-L",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Falta pouco! Nossa equipe estÃ¡ realizando o processo de anÃ¡lise da sua carta de crÃ©dito, logo mais enviaremos o resultado.",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_DOCUMENTS_UNDER_ANALYSIS",
                    "timeout": 1
                }
            },
            {
                "id": "ST23-L",
                "name": "Save message on entity message from NOTIFY_DOCUMENTS_UNDER_ANALYSIS.",
                "next": "ST41-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Falta pouco! Nossa equipe estÃ¡ realizando o processo de anÃ¡lise da sua carta de crÃ©dito, logo mais enviaremos o resultado.",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "ST41-L",
                "name": "get chat details and messages by chat ID.",
                "next": "SB13-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB13-L",
                "name": "Save messages history to bag.",
                "next": "EXIT-DOCUMENTS-ANALYSIS",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "EXIT-DOCUMENTS-ANALYSIS",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "ST16-R",
                "name": "Check if Realtor is able to contact with this lead.",
                "next": "ST16-R-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "buyer_number": {
                            "$mustache": "55{{bag.buyer_number}}"
                        },
                        "realtor_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/checkPreviousRealtor"
                        },
                        "verb": "POST",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "ST16-R-2",
                "name": "Set request to bag",
                "next": "REALTOR-NOTIFY-CLIENT",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "order": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "REALTOR-NOTIFY-CLIENT",
                "name": "Map request status",
                "next": "F7-R",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request_status": {
                            "$js": "({bag}) => bag.order.request_status === 'AWAITING_DOCUMENTS' ? 'Enviando Documentos' : bag.order.request_status === 'DOCUMENTS_RECEIVED' ? 'Documentos Enviados' : bag.order.request_status === 'APPROVED' ? 'Aprovado' : bag.order.request_status === 'DOCUMENTS_ANALYSIS' ? 'Documentos em AnÃ¡lise' : bag.order.request_status === 'CLOSED' ? 'Cancelado' : bag.order.request_status === 'REJECTED' ? 'Reprovado' : bag.order.request_status === 'DOCUMENTS_REJECTED' ? 'Documentos Rejeitados' : bag.order.request_status === 'DOCUMENTS_APPROVED' ? 'Documentos Aprovados' : 'Status NÃ£o Encontrado'"
                        }
                    }
                }
            },
            {
                "id": "F7-R",
                "name": "Is realtor able to create request for client?",
                "next": {
                    "CLOSED": "REALTOR-NOTIFY-CLIENT-3",
                    "default": "REALTOR-REQUEST-APPROVED-2-A-1",
                    "APPROVED": "REALTOR-REQUEST-APPROVED-1",
                    "NOT_ABLE": "REALTOR-NOTIFY-CLIENT-2",
                    "REJECTED": "REALTOR-NOTIFY-CLIENT-3",
                    "AWAITING_DOCUMENTS": "REALTOR-NOTIFY-CLIENT-1",
                    "DOCUMENTS_ANALYSIS": "REALTOR-NOTIFY-CLIENT-1",
                    "DOCUMENTS_APPROVED": "REALTOR-NOTIFY-CLIENT-1",
                    "DOCUMENTS_RECEIVED": "REALTOR-NOTIFY-CLIENT-1",
                    "DOCUMENTS_REJECTED": "REALTOR-NOTIFY-CLIENT-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.order.request_status"
                        }
                    }
                }
            },
            {
                "id": "REALTOR-NOTIFY-CLIENT-1",
                "name": "Notify request status",
                "next": "EXIT-NOTIFY-LEAD",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: NÃ£o Ã© possÃ­vel prosseguir com a solicitaÃ§Ã£o, pois o cliente informado jÃ¡ possui uma solicitaÃ§Ã£o de crÃ©dito em andamento na fase de *{{bag.request_status}}*. Por favor, informe outro nÃºmero ou entre em contato com o administrador."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_LEAD",
                    "timeout": 1
                }
            },
            {
                "id": "REALTOR-NOTIFY-CLIENT-2",
                "name": "Notify lead as not able",
                "next": "EXIT-LEAD-INVALID",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: NÃ£oÂ Ã©Â possÃ­velÂ prosseguirÂ comÂ aÂ solicitaÃ§Ã£o,Â poisÂ oÂ clienteÂ informadoÂ jÃ¡Â possuiÂ umÂ corretorÂ responsÃ¡velÂ porÂ ele. PorÂ favor,Â informeÂ outroÂ nÃºmeroÂ ouÂ entreÂ emÂ contatoÂ comÂ oÂ administrador.",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_LEAD",
                    "timeout": 1
                }
            },
            {
                "id": "REALTOR-NOTIFY-CLIENT-3",
                "name": "Notify request status",
                "next": "ST17-R",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: O cliente informado jÃ¡ possui uma solicitaÃ§Ã£o de crÃ©dito com o status *{{bag.request_status}}*."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_LEAD",
                    "timeout": 1
                }
            },
            {
                "id": "EXIT-LEAD-INVALID",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "ST17-R",
                "name": "Start new request workflow ",
                "next": "U13-R",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "requested": true,
                        "party_number": {
                            "$mustache": "55{{bag.buyer_number}}"
                        },
                        "realtor_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "timeout": 1,
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "new_request"
                }
            },
            {
                "id": "U13-R",
                "name": "Notify contacting lead",
                "next": "EXIT-NOTIFY-LEAD",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Beleza. Vou notificar o cliente e iniciar um novo fluxo de anÃ¡lise de crÃ©dito.",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_CONTACTING_LEAD",
                    "timeout": 1
                }
            },
            {
                "id": "EXIT-NOTIFY-LEAD",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "REALTOR-REQUEST-APPROVED-1",
                "name": "Notify request approved exist and make a question if is necessary reset.",
                "next": "REALTOR-REQUEST-APPROVED-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: O cliente informado jÃ¡ possui um pedido *{{bag.request_status}}* com o crÃ©dito de *{{bag.order.request_credit_limit_formatted}}*.\nDeseja iniciar uma nova anÃ¡lise de crÃ©dito?\n1 - Sim. \n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "NOTIFY_REQUEST_RESET"
                }
            },
            {
                "id": "REALTOR-REQUEST-APPROVED-2",
                "name": "Check realtor answer.",
                "next": {
                    "1": "REALTOR-REQUEST-APPROVED-2-A-1",
                    "2": "REALTOR-REQUEST-APPROVED-2-B-1",
                    "default": "REALTOR-REQUEST-APPROVED-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "REALTOR-REQUEST-APPROVED-2-A-1",
                "name": "Set request status equal 'CLOSED' and set current resquest equal null",
                "next": "ST17-R",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/reset/55{{bag.buyer_number}}/{{bag.order.request_id}}"
                        },
                        "verb": "PUT",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    }
                }
            },
            {
                "id": "REALTOR-REQUEST-APPROVED-2-B-1",
                "name": "Notify contacting lead",
                "next": "EXIT-NOTIFY-LEAD",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Tudo bem, estarei aqui quando precisar.",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_REALTOR_EXIT",
                    "timeout": 1
                }
            },
            {
                "id": "OLD-BUYER",
                "name": "Verify if profiles exists",
                "next": "SC-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/verify/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SC-1",
                "name": "Save user existence to bag.",
                "next": "OLD-BUYER-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profile_exist": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-A1",
                "name": "Check if profile exists",
                "next": {
                    "true": "NEW-REQUEST",
                    "default": "OLD-BUYER-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.profile_exist"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-1",
                "name": "Save on table message the first message sent from buyer.",
                "next": "OLD-BUYER-1-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.buyer_number"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "OLD-BUYER-1-A1",
                "name": "get chat details and messages by chat ID.",
                "next": "OLD-BUYER-1-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "OLD-BUYER-1-A2",
                "name": "Save messages history to bag.",
                "next": "OLD-BUYER-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-2",
                "name": "Get profile",
                "next": "OLD-BUYER-2-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "OLD-BUYER-2-A1",
                "name": "Save profile to bag.",
                "next": "OLD-BUYER-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "buyer_profile": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-3",
                "name": "Welcome back to buyer",
                "next": "OLD-BUYER-3-A1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Olha quem estÃ¡ aqui de novo! Estou feliz em te ver por aqui {{ bag.buyer_profile.nickname }}."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "WELCOME_BACK",
                    "timeout": 1
                }
            },
            {
                "id": "OLD-BUYER-3-A1",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "OLD-BUYER-3-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Olha quem estÃ¡ aqui de novo! Estou feliz em te ver por aqui {{ bag.buyer_profile.nickname }}."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "OLD-BUYER-3-A2",
                "name": "get chat details and messages by chat ID.",
                "next": "OLD-BUYER-3-A3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "OLD-BUYER-3-A3",
                "name": "Save messages history to bag.",
                "next": "OLD-BUYER-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-4",
                "name": "Capturing will to proceed",
                "next": "OLD-BUYER-4-A1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Prazer {{bag.buyer_profile.nickname}}, vem comigo que vou te mostrar o jeito mais fÃ¡cil de conquistar sua Casa PrÃ³pria sem aquelas burocracias e filas chatas, sabe? Vamos lÃ¡? \n1 - Sim, vamos! \n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_WILL_TO_PROCEED"
                }
            },
            {
                "id": "OLD-BUYER-4-A1",
                "name": "Save user consent to bag.",
                "next": "OLD-BUYER-4-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_consent": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-4-A2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "OLD-BUYER-4-A3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Prazer {{bag.buyer_profile.nickname}}, vem comigo que vou te mostrar o jeito mais fÃ¡cil de conquistar sua Casa PrÃ³pria sem aquelas burocracias e filas chatas, sabe? Vamos lÃ¡? \n1 - Sim, vamos! \n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "OLD-BUYER-4-A3",
                "name": "get chat details and messages by chat ID.",
                "next": "OLD-BUYER-4-A4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "OLD-BUYER-4-A4",
                "name": "Save messages history to bag.",
                "next": "OLD-BUYER-4-A5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-4-A5",
                "name": "Save on table message the user consent.",
                "next": "OLD-BUYER-4-A6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_consent"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "OLD-BUYER-4-A6",
                "name": "get chat details and messages by chat ID.",
                "next": "OLD-BUYER-4-A7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "OLD-BUYER-4-A7",
                "name": "Save messages history to bag.",
                "next": "OLD-BUYER-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-5",
                "name": "Check user consent",
                "next": {
                    "1": "OLD-BUYER-6",
                    "2": "NEW-REQUEST-5",
                    "default": "OLD-BUYER-4"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_consent"
                        }
                    }
                }
            },
            {
                "id": "OLD-BUYER-6",
                "name": "Check if buyer has current request",
                "next": {
                    "null": "ST5-L",
                    "default": "RESET-REQUEST-OLD-BUYER"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.buyer_profile.current_request_id"
                        }
                    }
                }
            },
            {
                "id": "RESET-REQUEST-OLD-BUYER",
                "name": "Set request status equal 'CLOSED' and set current resquest equal null",
                "next": "ST5-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/reset/{{bag.buyer_profile.mobile_phone}}/{{bag.buyer_profile.current_request_id}}"
                        },
                        "verb": "PUT",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST",
                "name": "Save on table message the first message sent from buyer.",
                "next": "NEW-REQUEST-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.buyer_number"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": null
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-A1",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1",
                "name": "Capturing client nickname",
                "next": "NEW-REQUEST-1-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: OlÃ¡! Eu sou a Bela, Assistente Virtual do Approva FÃ¡cil! ðŸ˜Š Estou feliz em te ver por aqui! Me fala, *como posso te chamar*?",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_NICKNAME"
                }
            },
            {
                "id": "NEW-REQUEST-1-A-1",
                "name": "Set nickname to bag",
                "next": "NEW-REQUEST-1-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "nickname": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-1-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: OlÃ¡! Eu sou a Bela do Aprova FÃ¡cil! ðŸ˜Š Estou feliz em te ver por aqui! Me fala, *como posso te chamar*?",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-3",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-1-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-4",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-1-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-5",
                "name": "Save on table message the nickname receveid.",
                "next": "NEW-REQUEST-1-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.nickname"
                        },
                        "external_id": {
                            "$ref": null
                        },
                        "chat_participant_id": {
                            "$ref": null
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-1-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-7",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-1-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-8",
                "name": "Capturing confirm nickname",
                "next": "NEW-REQUEST-1-A-9",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu *nome* estÃ¡ correto?\nNome: *{{bag.nickname}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_CONFIRM_NICKNAME"
                }
            },
            {
                "id": "NEW-REQUEST-1-A-9",
                "name": "Save user name to bag.",
                "next": "NEW-REQUEST-1-A-10",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_confirm_nickname": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-10",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-1-A-11",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu *nome* estÃ¡ correto?\nNome: *{{bag.nickname}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-11",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-1-A-12",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-12",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-1-A-13",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-13",
                "name": "Save name in table message.",
                "next": "NEW-REQUEST-1-A-14",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_confirm_nickname"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-14",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-1-A-15",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-1-A-15",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-1-A-16",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-1-A-16",
                "name": "Check if user confirm nickname",
                "next": {
                    "1": "NEW-REQUEST-2",
                    "2": "NEW-REQUEST-1",
                    "default": "NEW-REQUEST-1-A-8"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_confirm_nickname"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-2",
                "name": "Capturing will to proceed",
                "next": "NEW-REQUEST-2-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Prazer {{bag.nickname}}, vem comigo que vou te mostrar o jeito mais fÃ¡cil de conquistar sua Casa PrÃ³pria sem aquelas burocracias e filas chatas, sabe? Vamos lÃ¡? \n1 - Sim, vamos! \n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_WILL_TO_PROCEED"
                }
            },
            {
                "id": "NEW-REQUEST-2-A-1",
                "name": "Save user consent to bag.",
                "next": "NEW-REQUEST-2-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_consent": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-2-A-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-2-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Prazer {{bag.nickname}}, vem comigo que vou te mostrar o jeito mais fÃ¡cil de conquistar sua Casa PrÃ³pria sem aquelas burocracias e filas chatas, sabe? Vamos lÃ¡? \n1 - Sim, vamos! \n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-2-A-3",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-2-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-2-A-4",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-2-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-2-A-5",
                "name": "Save on table message the user consent.",
                "next": "NEW-REQUEST-2-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_consent"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": null
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-2-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-2-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-2-A-7",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-4",
                "name": "Check user consent",
                "next": {
                    "1": "NEW-REQUEST-6",
                    "2": "NEW-REQUEST-5",
                    "default": "NEW-REQUEST-2"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_consent"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-5",
                "name": "Notify user has not given consent",
                "next": "NEW-REQUEST-5-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: NÃ£o tem problema! Estarei aqui quando vocÃª estiver pronto, ok? Ã‰ sÃ³ me chamar! ðŸ˜Š",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_USER_HAS_NOT_GIVEN_WILL_TO_PROCEED",
                    "timeout": 1
                }
            },
            {
                "id": "NEW-REQUEST-5-A-1",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-5-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: NÃ£o tem problema! Estarei aqui quando vocÃª estiver pronto, ok? Ã‰ sÃ³ me chamar! ðŸ˜Š",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-5-A-2",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-5-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-5-A-3",
                "name": "Save messages history to bag.",
                "next": "EXIT-USER-DID-NOT-WANT-TO-PROCEED",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "EXIT-USER-DID-NOT-WANT-TO-PROCEED",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            },
            {
                "id": "NEW-REQUEST-6",
                "name": "Capturing client name",
                "next": "NEW-REQUEST-6-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Eba! Legal! Conta comigo! Agora, me fala o *seu nome completo* (vocÃª jÃ¡ me conhece e agora Ã© minha vez de te conhecer! ðŸ˜Š)",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_NAME"
                }
            },
            {
                "id": "NEW-REQUEST-6-A-1",
                "name": "Set name to bag",
                "next": "NEW-REQUEST-6-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "name": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-6-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Eba! Legal! Conta comigo! Agora, me fala o *seu nome completo* (vocÃª jÃ¡ me conhece e agora Ã© minha vez de te conhecer! ðŸ˜Š)",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-3",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-6-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-4",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-6-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-5",
                "name": "Save on table message the name receveid.",
                "next": "NEW-REQUEST-6-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.name"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": null
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-6-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-7",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-6-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-8",
                "name": "Capturing confirm name",
                "next": "NEW-REQUEST-6-A-9",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu nome completo estÃ¡ correto?\nNome completo: *{{bag.name}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_CONFIRM_NAME"
                }
            },
            {
                "id": "NEW-REQUEST-6-A-9",
                "name": "Save user name to bag.",
                "next": "NEW-REQUEST-6-A-10",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_confirm_name": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-10",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-6-A-11",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu nome completo estÃ¡ correto?\nNome completo: *{{bag.name}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-11",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-6-A-12",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-12",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-6-A-13",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-13",
                "name": "Save name in table message.",
                "next": "NEW-REQUEST-6-A-14",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_confirm_name"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-14",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-6-A-15",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-6-A-15",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-6-A-16",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-6-A-16",
                "name": "Check if user confirm name",
                "next": {
                    "1": "NEW-REQUEST-10",
                    "2": "NEW-REQUEST-6",
                    "default": "NEW-REQUEST-6-A-8"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_confirm_name"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10",
                "name": "Capturing client email",
                "next": "NEW-REQUEST-10-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Perfeito! Agora me fala seu *e-mail*, por favor?",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_EMAIL"
                }
            },
            {
                "id": "NEW-REQUEST-10-A-1",
                "name": "Set email to bag",
                "next": "NEW-REQUEST-10-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "email": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-10-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Perfeito! Agora me fala seu *e-mail*, por favor?",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-3",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-10-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-4",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-10-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-5",
                "name": "Save on table message the email receveid.",
                "next": "NEW-REQUEST-10-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.email"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": null
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-10-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-7",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-10-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-8",
                "name": "Capturing confirm email",
                "next": "NEW-REQUEST-10-A-9",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu email estÃ¡ correto?\nE-mail: *{{bag.email}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_CONFIRM_EMAIL"
                }
            },
            {
                "id": "NEW-REQUEST-10-A-9",
                "name": "Save user email to bag.",
                "next": "NEW-REQUEST-10-A-10",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_confirm_email": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-10",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-10-A-11",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: VocÃª poderia me confirmar se seu email estÃ¡ correto?\nE-mail: *{{bag.email}};*\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-11",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-10-A-12",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-12",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-10-A-13",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-13",
                "name": "Save name in table message.",
                "next": "NEW-REQUEST-10-A-14",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_confirm_email"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-14",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-10-A-15",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-10-A-15",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-10-A-16",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-10-A-16",
                "name": "Check if user confirm email",
                "next": {
                    "1": "ST1-L",
                    "2": "NEW-REQUEST-10",
                    "default": "NEW-REQUEST-10-A-7"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_confirm_email"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-12",
                "name": "Capturing user information",
                "next": "NEW-REQUEST-12-A1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Prontinho! JÃ¡ anotei as suas informaÃ§Ãµes aqui, agora vamos ao que interessa!"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "CAPTURING_INFORMATION",
                    "timeout": 1
                }
            },
            {
                "id": "NEW-REQUEST-12-A1",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-12-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Prontinho! JÃ¡ anotei as suas informaÃ§Ãµes aqui, agora vamos ao que interessa!"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-12-A2",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-12-A3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-12-A3",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-14-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-14-A2",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-14-A3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-14-A3",
                "name": "Save messages history to bag.",
                "next": "NEW-REQUEST-15",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "NEW-REQUEST-15",
                "name": "Notify written information",
                "next": "NEW-REQUEST-15-A1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Para vocÃª conquistar a Casa PrÃ³pria precisamos primeiro aprovar o seu crÃ©dito. SÃ£o apenas alguns documentos, ok? Mas pode ficar tranquilo, suas informaÃ§Ãµes estarÃ£o seguras aqui, e muito antes do que vocÃª imagina te daremos um retorno do status da sua carta de crÃ©dito. ðŸ¤©",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_WRITTEN_INFORMATION_SECOND_PART",
                    "timeout": 1
                }
            },
            {
                "id": "NEW-REQUEST-15-A1",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "NEW-REQUEST-15-A2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Para vocÃª conquistar a Casa PrÃ³pria precisamos primeiro aprovar o seu crÃ©dito. SÃ£o apenas alguns documentos, ok? Mas pode ficar tranquilo, suas informaÃ§Ãµes estarÃ£o seguras aqui, e muito antes do que vocÃª imagina te daremos um retorno do status da sua carta de crÃ©dito. ðŸ¤©",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-15-A2",
                "name": "get chat details and messages by chat ID.",
                "next": "NEW-REQUEST-15-A3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NEW-REQUEST-15-A3",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "ST1-L",
                "name": "Get Profile",
                "next": "F5-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "F5-L",
                "name": "User already exists?",
                "next": {
                    "true": "SB1-L",
                    "default": "ST2-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({result}) => (result.data.id) ? true : false"
                        }
                    }
                }
            },
            {
                "id": "ST2-L",
                "name": "Create actor",
                "next": "ST3-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "CreateActorTask",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "claims": {
                            "$ref": "bag.default_claims"
                        },
                        "account_id": {
                            "$ref": "bag.account_id"
                        }
                    }
                }
            },
            {
                "id": "ST3-L",
                "name": "Create profile",
                "next": "SB1-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "name": {
                            "$ref": "bag.name"
                        },
                        "email": {
                            "$ref": "bag.email"
                        },
                        "actor_id": {
                            "$ref": "result.actor.id"
                        },
                        "nickname": {
                            "$ref": "bag.nickname"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/create"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB1-L",
                "name": "Set party profile to bag",
                "next": "ST5-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "buyer_profile": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "ST5-L",
                "name": "Create Request",
                "next": "SB3-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "buyer_profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB3-L",
                "name": "Set request to bag",
                "next": "ST6-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "ST6-L",
                "name": "Assign Realtor to Request",
                "next": "SB4-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "realtor_number": {
                            "$ref": "bag.realtor_number"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/assign"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB4-L",
                "name": "Set buyer profile with new current_request to bag",
                "next": "CHAT-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "buyer_profile": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "CHAT-1",
                "name": "get chat or create if not exist",
                "next": "SB1-L-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat_by_buyer_mobile_phone/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB1-L-A1",
                "name": "Associate profile to chat",
                "next": "CHAT-1-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "request_id": {
                            "$ref": "bag.request.id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/associate_profile_to_chat/{{bag.party_number}}"
                        },
                        "verb": "PUT",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CHAT-1-A1",
                "name": "get chat or create if not exist",
                "next": "CHAT-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat_by_buyer_mobile_phone/{{bag.party_number}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CHAT-2",
                "name": "Set chat_id and chat_participant_id (buyer)",
                "next": "CHAT-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "result.data.chat_id"
                        },
                        "buyer_chat_participant_id": {
                            "$ref": "result.data.buyer_chat_participant_id"
                        },
                        "realtor_chat_participant_id": {
                            "$ref": "result.data.realtor_chat_participant_id"
                        }
                    }
                }
            },
            {
                "id": "CHAT-3",
                "name": "get chat details and messages by chat ID.",
                "next": "CHAT-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CHAT-4",
                "name": "Save messages history to bag.",
                "next": "F5-L-A1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "F5-L-A1",
                "name": "User already exists?",
                "next": {
                    "true": "NEW-REQUEST-12",
                    "default": "NEW-REQUEST-14-A2"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.profile_exist"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-3",
                "name": "Notify hints list",
                "next": "DOCUMENT-4",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Dicas importantes: \nðŸ’¡ Tire fotos em um lugar bem iluminado;\nðŸ’¡ Nada de foto tremida, ein?!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_HINTS_LIST",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-4",
                "name": "Save message on entity message from NOTIFY_HINTS_LIST",
                "next": "DOCUMENT-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Dicas importantes: \nðŸ’¡ Tire fotos em um lugar bem iluminado;\nðŸ’¡ Nada de foto tremida, ein?!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-5",
                "name": "Notify send documents",
                "next": "DOCUMENT-6",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_SEND_DOCUMENTS",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-6",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-7",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-8",
                "name": "Capturing CNH or RG.",
                "next": "DOCUMENT-8-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Prontinho! Agora Ã© sua vez! Primeiro, qual o documento de identificaÃ§Ã£o vocÃª prefere me informar?\n1 - CNH;\n2 - RG.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_CNH_OR_RG"
                }
            },
            {
                "id": "DOCUMENT-8-1",
                "name": "Save user document chose to bag.",
                "next": "DOCUMENT-8-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "files_phrases": [
                            {
                                "order": 1,
                                "is_text": "false",
                                "message": "Bela: Beleza! Agora, me envie uma *foto* ou *PDF* da frente do documento, por favor.",
                                "document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'CNH_FRONT' : result.activities[0].data.message === '2' ? 'RG_FRONT' : 'OTHER'"
                                },
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* da frente do documento, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Beleza! Agora, me envie uma *foto* ou *PDF* da frente do documento, por favor."
                            },
                            {
                                "order": 2,
                                "is_text": "false",
                                "message": "Bela: Obrigada! Documento recebido com sucesso! Agora, me envie uma *foto* ou *PDF* do verso, por favor.",
                                "document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'CNH_BACK' : result.activities[0].data.message === '2' ? 'RG_BACK' : 'OTHER'"
                                },
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do verso do documento, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Obrigada! Documento recebido com sucesso! Agora, me envie uma *foto* ou *PDF* do verso, por favor."
                            },
                            {
                                "order": 3,
                                "is_text": "true",
                                "document": "CPF_NATIVE",
                                "is_attachment": "false",
                                "second_document": "SECOND_CPF_NATIVE"
                            },
                            {
                                "order": 4,
                                "is_text": "false",
                                "message": "Bela: Obrigada! Me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia*, por favor.\nOBS: Verifique se estÃ¡ dentro do prazo de 60 dias.\n(pode ser fatura de cartÃ£o, gÃ¡s, Ã¡gua, conta de telefone ou celular, etc).",
                                "document": "DOCUMENT_RESIDENCE_PROOF",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia*, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Obrigada! Me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia* dele(a), por favor.\nOBS: Verifique se estÃ¡ dentro do prazo de 60 dias.\n(pode ser fatura de cartÃ£o, gÃ¡s, Ã¡gua, conta de telefone ou celular, etc).",
                                "second_document": "SECOND_DOCUMENT_RESIDENCE_PROOF"
                            },
                            {
                                "order": 5,
                                "is_text": "true",
                                "document": "DOCUMENT_INCOME_CERTIFICATE_TYPE",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_TYPE"
                            },
                            {
                                "order": 6,
                                "is_text": "false",
                                "message": "Bela: Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor.",
                                "document": "PROLABORE",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou Imposto de Renda vigente, por favor",
                                "is_attachment": "true",
                                "second_message": "Bela: Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente dele(a), por favor.",
                                "second_document": "SECOND_PROLABORE"
                            },
                            {
                                "order": 7,
                                "is_text": "false",
                                "document": "DOCUMENT_INCOME_CERTIFICATE",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de Renda*, por favor",
                                "is_attachment": "true",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE"
                            },
                            {
                                "order": 8,
                                "is_text": "true",
                                "document": "DOCUMENT_INCOME_CERTIFICATE_DATE",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_DATE"
                            },
                            {
                                "order": 9,
                                "is_text": "true",
                                "message": "Bela: Contando todos seus contratos de trabalho, vocÃª possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "document": "FGTS",
                                "is_attachment": "false",
                                "second_message": "Bela: Contando todos os contratos de trabalho, ele(a) possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "second_document": "SECOND_FGTS"
                            },
                            {
                                "order": 10,
                                "is_text": "true",
                                "document": "MARITAL_STATUS",
                                "is_attachment": "false",
                                "second_document": "SECOND_MARITAL_STATUS"
                            }
                        ],
                        "cpf_native_question": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Muito bem! Por favor, *digite* agora a sua *naturalidade* (exemplo: Rio de Janeiro - RJ).' : result.activities[0].data.message === '2' ? 'Bela: Muito bem! Por favor, *digite* agora o seu *CPF*.' : 'Digite 1 ou 2 para prosseguir.'"
                        },
                        "user_document_chose": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'CNH' : result.activities[0].data.message === '2' ? 'RG' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-8-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "DOCUMENT-8-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Prontinho! Agora Ã© sua vez! Primeiro, qual o documento de identificaÃ§Ã£o vocÃª prefere me informar?\n1 - CNH;\n2 - RG.\n(digite 1 ou 2 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-8-3",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-8-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-8-4",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-8-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-8-5",
                "name": "Save on table message the user document chose.",
                "next": "DOCUMENT-8-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_document_chose"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-8-6",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-8-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-8-7",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-8-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": 1
                    }
                }
            },
            {
                "id": "DOCUMENT-8-8",
                "name": "Check the next document to receive.",
                "next": {
                    "RG": "DOCUMENT-9-A-1",
                    "CNH": "DOCUMENT-9-A-1",
                    "default": "DOCUMENT-8"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_document_chose"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-9-A-1",
                "name": "Check upload last step.",
                "next": {
                    "true": "DOCUMENT-9-A-2",
                    "default": "ST10-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.next_document < 11"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-9-A-2",
                "name": "Check the next document to receive.",
                "next": {
                    "true": "DOCUMENT-10-A-1",
                    "default": "DOCUMENT-11"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].is_attachment"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-1",
                "name": "User uploading documents",
                "next": "DOCUMENT-10-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "external_id"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                },
                                "external_id": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "DOCUMENT-10-B-1",
                "name": "User uploading documents",
                "next": "DOCUMENT-10-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].error_message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "external_id"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                },
                                "external_id": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "DOCUMENT-10-A-2",
                "name": "Set external_id to bag",
                "next": "DOCUMENT-10-A-2-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "external_id": {
                            "$ref": "result.activities[0].data.external_id"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-2-1",
                "name": "Verify file extension",
                "next": "DOCUMENT-10-A-2-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "CheckExternalIdValidTask",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].document"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-2-2",
                "name": "Check if file extension is valid.",
                "next": {
                    "true": "DOCUMENT-10-A-3",
                    "default": "DOCUMENT-10-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-3",
                "name": "Check if any media file was received from customer.",
                "next": {
                    "true": "DOCUMENT-10-A-3-A-1",
                    "default": "DOCUMENT-10-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => (!!bag.external_id)"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-3-A-1",
                "name": "Save BOT message on entity message from USER_UPLOADING_DOCUMENTS",
                "next": "DOCUMENT-10-A-3-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-10-A-3-A-2",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-10-A-3-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-10-A-3-A-3",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-10-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-10-A-4",
                "name": "Create Proofs and Attachments",
                "next": "DOCUMENT-10-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].document"
                        },
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/proofs"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-10-A-5",
                "name": "Save on table message the media file receveid.",
                "next": "DOCUMENT-10-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.message ? bag.message : null"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-10-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-10-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-10-A-7",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11",
                "name": "Check the next document to receive.",
                "next": {
                    "FGTS": "DOCUMENT-11-D-1",
                    "default": "DOCUMENT-12",
                    "CPF_NATIVE": "DOCUMENT-11-A-1",
                    "DOCUMENT_PROFESSION": "DOCUMENT-11-E-1",
                    "DOCUMENT_INCOME_CERTIFICATE_DATE": "DOCUMENT-11-C-1",
                    "DOCUMENT_INCOME_CERTIFICATE_TYPE": "DOCUMENT-11-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].document"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-1",
                "name": "User send document data.",
                "next": "DOCUMENT-11-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "bag.cpf_native_question"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "DOCUMENT-11-A-2",
                "name": "Set message and external_id to bag",
                "next": "DOCUMENT-11-A-2-VALIDATE-CPF-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "user_cpf_native": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-1",
                "name": "Check if the chosen document is the RG",
                "next": {
                    "RG": "DOCUMENT-11-A-2-VALIDATE-CPF-2",
                    "default": "DOCUMENT-11-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_document_chose"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-2",
                "name": "Save parsed cpf to bag.",
                "next": "DOCUMENT-11-A-2-VALIDATE-CPF-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_cpf_native": {
                            "$js": "({bag}) => bag.user_cpf_native.replace(/[^0-9]/g, '')"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-3",
                "name": "Validate CPF",
                "next": "DOCUMENT-11-A-2-VALIDATE-CPF-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateCpfTask",
                "parameters": {
                    "input": {
                        "user_cpf_native": {
                            "$ref": "bag.user_cpf_native"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-4",
                "name": "Check result from validate CPF",
                "next": {
                    "false": "DOCUMENT-11-A-2-VALIDATE-CPF-5",
                    "default": "DOCUMENT-11-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-5",
                "name": "Send message to user informing about the invalid CPF",
                "next": "DOCUMENT-11-A-2-VALIDATE-CPF-6",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: O CPF informado Ã© invÃ¡lido!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_CPF",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-11-A-2-VALIDATE-CPF-6",
                "name": "Save message on entity message from NOTIFY_INVALID_CPF",
                "next": "DOCUMENT-11-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: O CPF informado Ã© invÃ¡lido!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-3",
                "name": "Save on table message the documents data",
                "next": "DOCUMENT-11-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.cpf_native_question"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-A-6",
                "name": "Create Proofs and Attachments",
                "next": "DOCUMENT-11-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].document"
                        },
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "external_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/proofs"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-7",
                "name": "Save on table message documents data receveid.",
                "next": "DOCUMENT-11-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.message"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-8",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-A-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-A-9",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-B-1",
                "name": "User send Proofs of income.",
                "next": "DOCUMENT-11-B-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}! Como vocÃª comprova sua renda?\n1 - Formal (Carteira Assinada);\n2 - Informal (Extrato BancÃ¡rio);\n3 - EmpresÃ¡rio (Contrato Social).\n(digite 1, 2 ou 3 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_PROOF_INCOME"
                }
            },
            {
                "id": "DOCUMENT-11-B-2",
                "name": "Save user proof income to bag.",
                "next": "DOCUMENT-11-B-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "files_phrases": [
                            {
                                "order": 6,
                                "is_text": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? true : result.activities[0].data.message === '3' ? false : ''"
                                },
                                "message": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'Bela: Qual Ã© a sua profissÃ£o? (ex: vendedor).' : result.activities[0].data.message === '3' ? 'Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor.' : ''"
                                },
                                "document": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'DOCUMENT_PROFESSION' : result.activities[0].data.message === '3' ? 'PROLABORE' : ''"
                                },
                                "error_message": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'Bela: Para prosseguir, preciso que vocÃª digite a sua profissÃ£o? (ex: vendedor)' : result.activities[0].data.message === '3' ? 'Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor' : ''"
                                },
                                "is_attachment": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? false : result.activities[0].data.message === '3' ? true : ''"
                                }
                            },
                            {
                                "order": 7,
                                "is_text": "false",
                                "message": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Certo, me envie uma *foto* ou *PDF* do *Contracheque*, por favor.' : result.activities[0].data.message === '2' ? 'Bela: Certo, me envie um *PDF* do *Extrato BancÃ¡rio* dos Ãºltimos 06 meses, por favor.' : 'Bela: Obrigada! Vou precisar tambÃ©m que me envie uma *foto* ou *PDF* do *Contrato Social*, por favor.'"
                                },
                                "document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'FORMAL' : result.activities[0].data.message === '2' ? 'INFORMAL' : result.activities[0].data.message === '3' ? 'EMPRESARIO(A)' : 'OTHER'"
                                },
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de Renda*, por favor",
                                "is_attachment": "true"
                            },
                            {
                                "order": 8,
                                "is_text": "true",
                                "document": "DOCUMENT_INCOME_CERTIFICATE_DATE",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_DATE"
                            },
                            {
                                "order": 9,
                                "is_text": "true",
                                "message": "Bela: Contando todos seus contratos de trabalho, vocÃª possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "document": "FGTS",
                                "is_attachment": "false",
                                "second_message": "Bela: Contando todos os contratos de trabalho, ele(a) possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "second_document": "SECOND_FGTS"
                            },
                            {
                                "order": 10,
                                "is_text": "true",
                                "document": "MARITAL_STATUS",
                                "is_attachment": "false",
                                "second_document": "SECOND_MARITAL_STATUS"
                            }
                        ],
                        "user_proof_income": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'FORMAL' : result.activities[0].data.message === '2' ? 'INFORMAL' : result.activities[0].data.message === '3' ? 'EMPRESARIO(A)' : 'OTHER'"
                        },
                        "user_proof_income_question_date": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Qual foi a data de admissÃ£o? Preciso que me informe mÃªs e ano (ex: 02/2021).' : result.activities[0].data.message === '2' ? 'Bela: Desde quando vocÃª trabalha nessa atividade? Preciso que me informe mÃªs e ano (ex: 02/2021).' : 'Bela: Quando a empresa foi fundada? Preciso que me informe mÃªs e ano (Ex: 02/2021).'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-B-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-11-B-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}! Como vocÃª comprova sua renda?\n1 - Formal (Carteira Assinada);\n2 - Informal (Extrato BancÃ¡rio);\n3 - EmpresÃ¡rio (Contrato Social).\n(digite 1, 2 ou 3 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-B-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-B-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-B-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-B-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-B-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-11-B-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_proof_income"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-B-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-B-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-B-8",
                "name": "Check income proof type chosen.",
                "next": {
                    "FORMAL": "DOCUMENT-11-B-8-B-1",
                    "default": "DOCUMENT-11-B-1",
                    "INFORMAL": "DOCUMENT-11-B-8-A-1",
                    "EMPRESARIO(A)": "DOCUMENT-11-B-8-A-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_proof_income"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-B-8-A-1",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-B-8-B-1",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 2"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-C-1",
                "name": "User send document data.",
                "next": "DOCUMENT-11-C-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "bag.user_proof_income_question_date"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_PROOF_INCOME_DATE"
                }
            },
            {
                "id": "DOCUMENT-11-C-2",
                "name": "Set message and external_id to bag",
                "next": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "user_proof_income_date": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-1",
                "name": "Validate input from user proof income date",
                "next": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateAdmissionDateTask",
                "parameters": {
                    "input": {
                        "user_proof_income_date": {
                            "$ref": "bag.user_proof_income_date"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-2",
                "name": "Check result from validate proof income date",
                "next": {
                    "false": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-3",
                    "default": "DOCUMENT-11-C-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-3",
                "name": "Send message informing about the invalid proof income date",
                "next": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-4",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: A data informada Ã© invÃ¡lida!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_PROOF_INCOME_DATE",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-11-C-2-VALIDATE-PROOF-INCOME-DATE-4",
                "name": "Save message on entity message from NOTIFY_INVALID_PROOF_INCOME_DATE",
                "next": "DOCUMENT-11-C-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: A data informada Ã© invÃ¡lida!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-C-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-11-C-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_proof_income_question_date"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-C-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-C-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-C-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-C-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-C-6",
                "name": "Save on table message the media file receveid.",
                "next": "DOCUMENT-11-C-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.message"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-C-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-C-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-C-8",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-1",
                "name": "User send FGTS data.",
                "next": "DOCUMENT-11-D-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_FGTS"
                }
            },
            {
                "id": "DOCUMENT-11-D-2",
                "name": "Save user proof income to bag.",
                "next": "DOCUMENT-11-D-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_fgts": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-11-D-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-D-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-D-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-11-D-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_fgts"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-D-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-8",
                "name": "Check the next document to receive.",
                "next": {
                    "SIM": "DOCUMENT-11-D-8-A-1",
                    "NÃƒO": "DOCUMENT-11-D-9",
                    "default": "DOCUMENT-11-D-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_fgts"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-1",
                "name": "User send FGTS value.",
                "next": "DOCUMENT-11-D-8-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Qual o valor do saldo do seu FGTS?\n(nÃ£o Ã© necessÃ¡rio digitar 'R$', exemplo: 6.500,00).",
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_FGTS_VALUE"
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-2",
                "name": "Save FGTS value to bag.",
                "next": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_fgts_value": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-1",
                "name": "Check if the input value of FGTS is a currency",
                "next": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateCurrencyTask",
                "parameters": {
                    "input": {
                        "user_fgts_value": {
                            "$ref": "bag.user_fgts_value"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-2",
                "name": "Check result from validate user FGTS value",
                "next": {
                    "false": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-3",
                    "default": "DOCUMENT-11-D-8-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-3",
                "name": "Send message informing about the invalid FGTS value",
                "next": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-4",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: O valor informado Ã© invÃ¡lido!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_FGTS_VALUE",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-2-VALIDATE-FGTS-VALUE-4",
                "name": "Save message on entity message from NOTIFY_INVALID_FGTS_VALUE",
                "next": "DOCUMENT-11-D-8-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: O valor informado Ã© invÃ¡lido!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-3",
                "name": "Save message from bot on message.",
                "next": "DOCUMENT-11-D-8-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Qual o valor do saldo do seu FGTS?\n(nÃ£o Ã© necessÃ¡rio digitar 'R$', exemplo: 6.500,00).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-D-8-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-D-8-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-11-D-8-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_fgts_value"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-8-A-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-D-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-D-9",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-E-1",
                "name": "User send profession data.",
                "next": "DOCUMENT-11-E-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_PROFESSION"
                }
            },
            {
                "id": "DOCUMENT-11-E-2",
                "name": "Save user profession to bag.",
                "next": "DOCUMENT-11-E-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_profession": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-E-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-11-E-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-E-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-E-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-E-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-11-E-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-11-E-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-11-E-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_profession"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-E-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-11-E-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-11-E-8",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-9-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-12",
                "name": "User send Marital Status.",
                "next": "DOCUMENT-13",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Anotado! Me informe agora, qual Ã© o seu Estado Civil?\n1 - Solteiro(a);\n2 - Casado(a);\n3 - Divorciado(a) ou viÃºvo(a).\n(digite 1, 2 ou 3 para prosseguir).",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_MARITAL_STATUS"
                }
            },
            {
                "id": "DOCUMENT-13",
                "name": "Save user marital status to bag.",
                "next": "DOCUMENT-13-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_marital_status": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SOLTEIRO(A)' : result.activities[0].data.message === '2' ? 'CASADO(A)' : result.activities[0].data.message === '3' ? 'DIVORCIADO(A)-VIUVO(A)' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-13-A-1",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-13-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Anotado! Me informe agora, qual Ã© o seu Estado Civil?\n1 - Solteiro(a);\n2 - Casado(a);\n3 - Divorciado(a) ou viÃºvo(a).\n(digite 1, 2 ou 3 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-13-A-2",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-13-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-13-A-3",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-13-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-13-A-4",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-13-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_marital_status"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-13-A-5",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-13-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-13-A-6",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-14",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-14",
                "name": "Check marital status chosen.",
                "next": {
                    "default": "DOCUMENT-12",
                    "CASADO(A)": "DOCUMENT-18",
                    "SOLTEIRO(A)": "DOCUMENT-14-A-1",
                    "DIVORCIADO(A)-VIUVO(A)": "DOCUMENT-15"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_marital_status"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-14-A-1",
                "name": "User send Marital Status.",
                "next": "DOCUMENT-14-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: VocÃª possui *UniÃ£o EstÃ¡vel* em cartÃ³rio?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_STABLE_UNION"
                }
            },
            {
                "id": "DOCUMENT-14-A-2",
                "name": "Save user union stable to bag.",
                "next": "DOCUMENT-14-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_stable_union": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-14-A-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-14-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: VocÃª possui *UniÃ£o EstÃ¡vel* em cartÃ³rio?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-14-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-14-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-14-A-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-14-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-14-A-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-14-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_stable_union"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-14-A-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-14-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-14-A-8",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-14-A-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-14-A-9",
                "name": "Check union stable",
                "next": {
                    "SIM": "DOCUMENT-18",
                    "NÃƒO": "DOCUMENT-15",
                    "default": "DOCUMENT-14-A-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_stable_union"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-15",
                "name": "Check if user chosen a second buyer.",
                "next": "DOCUMENT-15-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: VocÃª irÃ¡ compor a renda com mais alguma pessoa?\n(ex: namorado(a), noivo(a), amigo(a), pais ... )\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_SECOND_BUYER"
                }
            },
            {
                "id": "DOCUMENT-15-A-1",
                "name": "Save user has second buyer to bag.",
                "next": "DOCUMENT-15-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_second_buyer": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-15-A-2",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-15-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: VocÃª irÃ¡ compor a renda com mais alguma pessoa?\n(ex: namorado(a), noivo(a), amigo(a), pais ... )\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-15-A-3",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-15-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-15-A-4",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-15-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-15-A-5",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-15-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_second_buyer"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-15-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-15-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-15-A-7",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-15-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-15-A-8",
                "name": "Check second buyer.",
                "next": {
                    "SIM": "DOCUMENT-18",
                    "NÃƒO": "DOCUMENT-17",
                    "default": "DOCUMENT-15"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_second_buyer"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-17",
                "name": "Send audio URL to user for descript dependents",
                "next": "DOCUMENT-17-A-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: A seguir, seguem algumas regras para a inclusÃ£o de dependentes.",
                        "media_url": "https://aprova-files-qa.s3.amazonaws.com/aprova_files/audio/bb9b9290-119f-11ec-969d-9f25c0966d06-Bea%20Voz.mp3",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS",
                    "timeout": 1
                }
            },
            {
                "id": "DOCUMENT-17-A-1",
                "name": "Check if user has dependents.",
                "next": "DOCUMENT-17-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: VocÃª possui dependente(s)?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).\nObs: Por favor, Ã© importante escutar o Ã¡udio antes de prosseguir.",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_USER_HAS_DEPENDENTS"
                }
            },
            {
                "id": "DOCUMENT-17-A-2",
                "name": "Save user dependents to bag.",
                "next": "DOCUMENT-17-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "user_dependents": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-17-A-3",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-17-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: VocÃª possui dependente(s)?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).\nObs: Por favor, Ã© importante escutar o Ã¡udio antes de prosseguir.",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-17-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-17-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-17-A-5",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-17-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-17-A-6",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-17-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.user_dependents"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-17-A-7",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-17-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-17-A-8",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-17-A-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-17-A-9",
                "name": "Check user has dependents.",
                "next": {
                    "SIM": "DOCUMENT-18",
                    "NÃƒO": "DOCUMENT-18",
                    "default": "DOCUMENT-17"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_dependents"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-18",
                "name": "Check if has a second buyer.",
                "next": {
                    "true": "SECOND-DOCUMENT",
                    "default": "ST10-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.user_second_buyer === 'SIM' || bag.user_stable_union === 'SIM' || bag.user_marital_status === 'CASADO(A)'"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT",
                "name": "Notify upload inform",
                "next": "SECOND-DOCUMENT-NOTIFICATION",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Aee {{bag.buyer_profile.nickname}}, estamos quase lÃ¡!!! Recebi todos os seus documentos. Vou precisar dos documentos do seu parceiro(a), beleza?!"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_SECOND_BUYER_DATA",
                    "timeout": 1
                }
            },
            {
                "id": "SECOND-DOCUMENT-NOTIFICATION",
                "name": "Save message on entity message from NOTIFY_SECOND_BUYER_DATA.",
                "next": "SECOND-DOCUMENT-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Aee {{bag.buyer_profile.nickname}}, estamos quase lÃ¡!!! Recebi todos os seus documentos. Vou precisar dos documentos do seu parceiro(a), beleza?!"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-1",
                "name": "Capturing CNH or RG.",
                "next": "SECOND-DOCUMENT-1-1",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: EntÃ£o vamos lÃ¡!!\nQual o documento de identificaÃ§Ã£o do seu parceiro(a) vocÃª prefere me informar.\n1 - CNH;\n2 - RG.\n(digite 1 ou 2 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_CNH_OR_RG"
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-1",
                "name": "Save user document chose to bag.",
                "next": "SECOND-DOCUMENT-1-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "files_phrases": [
                            {
                                "order": 1,
                                "is_text": "false",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* da frente do documento, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Beleza! Agora, me envie uma *foto* ou *PDF* da frente do documento, por favor.",
                                "second_document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'SECOND_CNH_FRONT' : result.activities[0].data.message === '2' ? 'SECOND_RG_FRONT' : 'OTHER'"
                                }
                            },
                            {
                                "order": 2,
                                "is_text": "false",
                                "message": "Bela: Obrigada! Documento recebido com sucesso! Agora, me envie uma *foto* ou *PDF* do verso, por favor.",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do verso do documento, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Obrigada! Documento recebido com sucesso! Agora, me envie uma *foto* ou *PDF* do verso, por favor.",
                                "second_document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'SECOND_CNH_BACK' : result.activities[0].data.message === '2' ? 'SECOND_RG_BACK' : 'OTHER'"
                                }
                            },
                            {
                                "order": 3,
                                "is_text": "true",
                                "document": "CPF_NATIVE",
                                "is_attachment": "false",
                                "second_document": "SECOND_CPF_NATIVE"
                            },
                            {
                                "order": 4,
                                "is_text": "false",
                                "message": "Bela: Obrigada! Me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia*, por favor.\nOBS: Verifique se estÃ¡ dentro do prazo de 60 dias.\n(pode ser fatura de cartÃ£o, gÃ¡s, Ã¡gua, conta de telefone ou celular, etc).",
                                "document": "DOCUMENT_RESIDENCE_PROOF",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia*, por favor.",
                                "is_attachment": "true",
                                "second_message": "Bela: Obrigada! Me envie uma *foto* ou *PDF* do *Comprovante de ResidÃªncia* dele(a), por favor.\nOBS: Verifique se estÃ¡ dentro do prazo de 60 dias.\n(pode ser fatura de cartÃ£o, gÃ¡s, Ã¡gua, conta de telefone ou celular, etc).",
                                "second_document": "SECOND_DOCUMENT_RESIDENCE_PROOF"
                            },
                            {
                                "order": 5,
                                "is_text": "true",
                                "document": "DOCUMENT_INCOME_CERTIFICATE_TYPE",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_TYPE"
                            },
                            {
                                "order": 6,
                                "is_text": "false",
                                "message": "Bela: Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor.",
                                "document": "PROLABORE",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou Imposto de Renda vigente, por favor",
                                "is_attachment": "true",
                                "second_message": "Bela: Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente dele(a), por favor.",
                                "second_document": "SECOND_PROLABORE"
                            },
                            {
                                "order": 7,
                                "is_text": "false",
                                "document": "DOCUMENT_INCOME_CERTIFICATE",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de Renda*, por favor",
                                "is_attachment": "true",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE"
                            },
                            {
                                "order": 8,
                                "is_text": "true",
                                "document": "DOCUMENT_INCOME_CERTIFICATE_DATE",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_DATE"
                            },
                            {
                                "order": 9,
                                "is_text": "true",
                                "message": "Bela: Contando todos seus contratos de trabalho, vocÃª possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "document": "FGTS",
                                "is_attachment": "false",
                                "second_message": "Bela: Contando todos os contratos de trabalho, ele(a) possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "second_document": "SECOND_FGTS"
                            },
                            {
                                "order": 10,
                                "is_text": "true",
                                "document": "MARITAL_STATUS",
                                "is_attachment": "false",
                                "second_document": "SECOND_MARITAL_STATUS"
                            }
                        ],
                        "second_cpf_native_question": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Muito bem! Por favor, *digite* agora a *naturalidade* (exemplo: Rio de Janeiro - RJ).' : result.activities[0].data.message === '2' ? 'Bela: Muito bem! Por favor, *digite* agora o *CPF*.' : 'Digite 1 ou 2 para prosseguir.'"
                        },
                        "second_user_document_chose": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'CNH' : result.activities[0].data.message === '2' ? 'RG' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-2",
                "name": "Save on table message the message sent from virtual assistant to buyer.",
                "next": "SECOND-DOCUMENT-1-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: EntÃ£o vamos lÃ¡!!\nQual o documento de identificaÃ§Ã£o do seu parceiro(a) vocÃª prefere me informar.\n1 - CNH;\n2 - RG.\n(digite 1 ou 2 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-3",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-1-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-4",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-1-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-5",
                "name": "Save on table message the user document chose.",
                "next": "SECOND-DOCUMENT-1-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_document_chose"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-6",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-1-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-7",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-1-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": 1
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-1-8",
                "name": "Check the next document to receive.",
                "next": {
                    "RG": "SECOND-DOCUMENT-2-A-1",
                    "CNH": "SECOND-DOCUMENT-2-A-1",
                    "default": "SECOND-DOCUMENT-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_document_chose"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-2-A-1",
                "name": "Check upload last step.",
                "next": {
                    "true": "SECOND-DOCUMENT-2-A-2",
                    "default": "ST10-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.next_document < 11"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-2-A-2",
                "name": "Check the next document to receive.",
                "next": {
                    "true": "SECOND-DOCUMENT-3-A-1",
                    "default": "SECOND-DOCUMENT-4"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].is_attachment"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-1",
                "name": "User uploading documents",
                "next": "SECOND-DOCUMENT-3-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "external_id"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                },
                                "external_id": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-B-1",
                "name": "User uploading documents",
                "next": "SECOND-DOCUMENT-3-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].error_message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "external_id"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                },
                                "external_id": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-2",
                "name": "Set external_id to bag",
                "next": "SECOND-DOCUMENT-3-A-2-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "external_id": {
                            "$ref": "result.activities[0].data.external_id"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-2-1",
                "name": "Verify file extension",
                "next": "SECOND-DOCUMENT-3-A-2-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "CheckExternalIdValidTask",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].document"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-2-2",
                "name": "Check if file extension is valid.",
                "next": {
                    "true": "SECOND-DOCUMENT-3-A-3",
                    "default": "SECOND-DOCUMENT-3-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-3",
                "name": "Check if any media file was received from customer.",
                "next": {
                    "true": "SECOND-DOCUMENT-3-A-3-A-1",
                    "default": "SECOND-DOCUMENT-3-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => (!!bag.external_id)"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-3-A-1",
                "name": "Save BOT message on entity message from USER_UPLOADING_DOCUMENTS",
                "next": "SECOND-DOCUMENT-3-A-3-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-3-A-2",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-3-A-3-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-3-A-3",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-3-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-4",
                "name": "Create Proofs and Attachments",
                "next": "SECOND-DOCUMENT-3-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_document"
                        },
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/proofs"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-5",
                "name": "Save on table message the media file received.",
                "next": "SECOND-DOCUMENT-3-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.message ? bag.message : null"
                        },
                        "external_id": {
                            "$ref": "bag.external_id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-6",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-3-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-3-A-7",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4",
                "name": "Check the next document to receive.",
                "next": {
                    "default": "SECOND-DOCUMENT-5",
                    "SECOND_FGTS": "SECOND-DOCUMENT-4-D-1",
                    "SECOND_CPF_NATIVE": "SECOND-DOCUMENT-4-A-1",
                    "SECOND_DOCUMENT_PROFESSION": "SECOND-DOCUMENT-4-E-1",
                    "SECOND_DOCUMENT_INCOME_CERTIFICATE_DATE": "SECOND-DOCUMENT-4-C-1",
                    "SECOND_DOCUMENT_INCOME_CERTIFICATE_TYPE": "SECOND-DOCUMENT-4-B-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_document"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-1",
                "name": "User send document data.",
                "next": "SECOND-DOCUMENT-4-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "bag.second_cpf_native_question"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_UPLOADING_DOCUMENTS"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2",
                "name": "Set message and external_id to bag",
                "next": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "second_user_cpf_native": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-1",
                "name": "Check if the chosen document of the second buyer is the RG",
                "next": {
                    "RG": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-2",
                    "default": "SECOND-DOCUMENT-4-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_document_chose"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-2",
                "name": "Save parsed cpf to bag.",
                "next": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_cpf_native": {
                            "$js": "({bag}) => bag.second_user_cpf_native.replace(/[^0-9]/g, '')"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-3",
                "name": "Validate second user CPF",
                "next": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateCpfTask",
                "parameters": {
                    "input": {
                        "user_cpf_native": {
                            "$ref": "bag.second_user_cpf_native"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-4",
                "name": "Check result from validate second user CPF",
                "next": {
                    "false": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-5",
                    "default": "SECOND-DOCUMENT-4-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-5",
                "name": "Send message informing about the invalid CPF",
                "next": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-6",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: O CPF informado Ã© invÃ¡lido!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_CPF",
                    "timeout": 1
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-2-VALIDATE-CPF-6",
                "name": "Save message on entity message from NOTIFY_INVALID_CPF",
                "next": "SECOND-DOCUMENT-4-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: O CPF informado Ã© invÃ¡lido!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-3",
                "name": "Save on table message the documents data",
                "next": "SECOND-DOCUMENT-4-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_cpf_native_question"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-6",
                "name": "Create Proofs and Attachments",
                "next": "SECOND-DOCUMENT-4-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "document": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_document"
                        },
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "external_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/proofs"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-7",
                "name": "Save on table message the media file receveid.",
                "next": "SECOND-DOCUMENT-4-A-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.message"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-8",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-A-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-A-9",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-1",
                "name": "User send Proofs of income.",
                "next": "SECOND-DOCUMENT-4-B-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}! Como ele(a) comprova renda?\n1 - Formal (Carteira Assinada);\n2 - Informal (Extrato BancÃ¡rio);\n3 - EmpresÃ¡rio (Contrato Social);\n4 - NÃ£o possui renda.\n(digite 1, 2, 3 ou 4 para prosseguir)."
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_PROOF_INCOME"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-2",
                "name": "Save user proof income to bag.",
                "next": "SECOND-DOCUMENT-4-B-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "files_phrases": [
                            {
                                "order": 6,
                                "is_text": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? true : result.activities[0].data.message === '3' ? false : ''"
                                },
                                "error_message": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'Bela: Para prosseguir, preciso que vocÃª digite a profissÃ£o dele(a)? (ex: vendedor)' : result.activities[0].data.message === '3' ? 'Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor' : ''"
                                },
                                "is_attachment": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? false : result.activities[0].data.message === '3' ? true : ''"
                                },
                                "second_message": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'Bela: Qual Ã© a profissÃ£o dele(a)? (ex: vendedor).' : result.activities[0].data.message === '3' ? 'Certo, me envie uma *foto* ou *PDF* do *PrÃ³-labore* ou *Imposto de Renda* vigente, por favor.' : ''"
                                },
                                "second_document": {
                                    "$js": "({result}) => result.activities[0].data.message === '2' ? 'SECOND_DOCUMENT_PROFESSION' : result.activities[0].data.message === '3' ? 'SECOND_PROLABORE' : ''"
                                }
                            },
                            {
                                "order": 7,
                                "is_text": "false",
                                "error_message": "Bela: Para prosseguir, preciso que vocÃª me envie uma *foto* ou *PDF* do *Comprovante de Renda* dele(a), por favor",
                                "is_attachment": "true",
                                "second_message": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Certo, me envie uma *foto* ou *PDF* do *Contracheque*, por favor.' : result.activities[0].data.message === '2' ? 'Bela: Certo, me envie um *PDF* do *Extrato BancÃ¡rio* dos Ãºltimos 06 meses, por favor.' : 'Bela: Obrigada! Vou precisar tambÃ©m que me envie uma *foto* ou *PDF* do *Contrato Social* dele(a), por favor.'"
                                },
                                "second_document": {
                                    "$js": "({result}) => result.activities[0].data.message === '1' ? 'SECOND_FORMAL' : result.activities[0].data.message === '2' ? 'SECOND_INFORMAL' : result.activities[0].data.message === '3' ? 'SECOND_EMPRESARIO(A)' : 'OTHER'"
                                }
                            },
                            {
                                "order": 8,
                                "is_text": "true",
                                "is_attachment": "false",
                                "second_document": "SECOND_DOCUMENT_INCOME_CERTIFICATE_DATE"
                            },
                            {
                                "order": 9,
                                "is_text": "true",
                                "message": "Bela: Contando todos seus contratos de trabalho, vocÃª possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "is_attachment": "false",
                                "second_message": "Bela: Contando todos os contratos de trabalho, ele(a) possui mais de 36 meses de carteira assinada? NÃ£o precisa ser na mesma empresa.\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                                "second_document": "SECOND_FGTS"
                            },
                            {
                                "order": 10,
                                "is_text": "true",
                                "is_attachment": "false",
                                "second_document": "SECOND_MARITAL_STATUS"
                            }
                        ],
                        "second_user_proof_income": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'FORMAL' : result.activities[0].data.message === '2' ? 'INFORMAL' : result.activities[0].data.message === '3' ? 'EMPRESARIO(A)' : result.activities[0].data.message === '4' ? 'SEM_RENDA' : 'OTHER'"
                        },
                        "second_user_proof_income_question_date": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'Bela: Qual foi a data de admissÃ£o dele(a)? Preciso que me informe mÃªs e ano (ex: 02/2021).' : result.activities[0].data.message === '2' ? 'Bela: Desde quando ele(a) trabalha nessa atividade? MÃªs e Ano (Ex: 02/2021)' : 'Bela: Quando a empresa dele(a) fundada? Preciso que me informe mÃªs e ano (Ex: 02/2021).'"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-3",
                "name": "Save on table message the bot message.",
                "next": "SECOND-DOCUMENT-4-B-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}! Como ele(a) comprova renda?\n1 - Formal (Carteira Assinada);\n2 - Informal (Extrato BancÃ¡rio);\n3 - EmpresÃ¡rio (Contrato Social);\n4 - NÃ£o possui renda.\n(digite 1, 2, 3 ou 4 para prosseguir)."
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-B-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-B-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-6",
                "name": "Save on table message the user response.",
                "next": "SECOND-DOCUMENT-4-B-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_proof_income"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-7",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-B-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-8",
                "name": "Check the next document to receive.",
                "next": {
                    "FORMAL": "SECOND-DOCUMENT-4-B-8-B-1",
                    "default": "SECOND-DOCUMENT-4-B-1",
                    "INFORMAL": "SECOND-DOCUMENT-4-B-8-C-1",
                    "SEM_RENDA": "SECOND-DOCUMENT-4-B-8-A-1",
                    "EMPRESARIO(A)": "SECOND-DOCUMENT-4-B-8-C-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_proof_income"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-8-A-1",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 4"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-8-B-1",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 2"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-B-8-C-1",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-1",
                "name": "User send document data.",
                "next": "SECOND-DOCUMENT-4-C-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "bag.second_user_proof_income_question_date"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_PROOF_INCOME_DATE"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-2",
                "name": "Set message and external_id to bag",
                "next": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "second_user_proof_income_date": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-1",
                "name": "Validate input from second user proof income date",
                "next": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateAdmissionDateTask",
                "parameters": {
                    "input": {
                        "user_proof_income_date": {
                            "$ref": "bag.second_user_proof_income_date"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-2",
                "name": "Check result from validate proof income date from second user",
                "next": {
                    "false": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-3",
                    "default": "SECOND-DOCUMENT-4-C-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-3",
                "name": "Send message informing about the invalid proof income date from second user",
                "next": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-4",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: A data informada Ã© invÃ¡lida!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_PROOF_INCOME_DATE",
                    "timeout": 1
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-2-VALIDATE-PROOF-INCOME-DATE-4",
                "name": "Save message on entity message from NOTIFY_INVALID_PROOF_INCOME_DATE",
                "next": "SECOND-DOCUMENT-4-C-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: A data informada Ã© invÃ¡lida!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-3",
                "name": "Save on table message the bot message.",
                "next": "SECOND-DOCUMENT-4-C-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_proof_income_question_date"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-C-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-C-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-6",
                "name": "Save on table message the media file received.",
                "next": "SECOND-DOCUMENT-4-C-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.message"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-7",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-C-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-C-8",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-1",
                "name": "User send FGTS data.",
                "next": "SECOND-DOCUMENT-4-D-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_FGTS"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-2",
                "name": "Save user proof income to bag.",
                "next": "SECOND-DOCUMENT-4-D-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_fgts": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-3",
                "name": "Save on table message the bot message.",
                "next": "SECOND-DOCUMENT-4-D-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-D-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-D-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-6",
                "name": "Save on table message the user response.",
                "next": "SECOND-DOCUMENT-4-D-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_fgts"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-7",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-D-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8",
                "name": "Check the next document to receive.",
                "next": {
                    "SIM": "SECOND-DOCUMENT-4-D-8-A-1",
                    "NÃƒO": "SECOND-DOCUMENT-4-D-9",
                    "default": "SECOND-DOCUMENT-4-D-1"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_fgts"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-1",
                "name": "User send FGTS value.",
                "next": "SECOND-DOCUMENT-4-D-8-A-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Qual o valor do saldo do FGTS dele(a)?\n(nÃ£o Ã© necessÃ¡rio digitar 'R$', exemplo: 6.500,00).",
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_FGTS_VALUE"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-2",
                "name": "Save FGTS value to bag.",
                "next": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_fgts_value": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-1",
                "name": "Check if the input FGTS value from second user is a currency",
                "next": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "ValidateCurrencyTask",
                "parameters": {
                    "input": {
                        "second_user_fgts_value": {
                            "$ref": "bag.second_user_fgts_value"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-2",
                "name": "Check result from validate second user FGTS value",
                "next": {
                    "false": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-3",
                    "default": "SECOND-DOCUMENT-4-D-8-A-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.is_valid"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-3",
                "name": "Send message informing about the invalid FGTS value from second user",
                "next": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-4",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: O valor informado Ã© invÃ¡lido!",
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_INVALID_FGTS_VALUE",
                    "timeout": 1
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-2-VALIDATE-FGTS-VALUE-4",
                "name": "Save message on entity message from NOTIFY_INVALID_FGTS_VALUE",
                "next": "SECOND-DOCUMENT-4-D-8-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: O valor informado Ã© invÃ¡lido!",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-3",
                "name": "Save message from bot on message.",
                "next": "SECOND-DOCUMENT-4-D-8-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Qual o valor do saldo do FGTS dele(a)?\n(nÃ£o Ã© necessÃ¡rio digitar 'R$', exemplo: 6.500,00).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-D-8-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-D-8-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-6",
                "name": "Save on table message the user response.",
                "next": "SECOND-DOCUMENT-4-D-8-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_fgts_value"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-8-A-7",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-D-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-D-9",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-1",
                "name": "User send profession data.",
                "next": "SECOND-DOCUMENT-4-E-2",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "document": {
                            "$ref": "bag.next_document"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "USER_SEND_PROFESSION"
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-2",
                "name": "Save second user profession to bag.",
                "next": "SECOND-DOCUMENT-4-E-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_profession": {
                            "$ref": "result.activities[0].data.message"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-3",
                "name": "Save on table message the bot message.",
                "next": "SECOND-DOCUMENT-4-E-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => bag.files_phrases.filter((document) => document.order === bag.next_document)[0].second_message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-4",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-E-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-5",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-4-E-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-6",
                "name": "Save on table message the user response.",
                "next": "SECOND-DOCUMENT-4-E-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_profession"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-7",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-4-E-8",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-4-E-8",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-2-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        },
                        "next_document": {
                            "$js": "({bag}) => bag.next_document + 1"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-5",
                "name": "Check the if has second buyer.",
                "next": {
                    "SIM": "SECOND-DOCUMENT-5-A-1",
                    "default": "ST10-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.user_second_buyer"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-5-A-1",
                "name": "User send Marital Status.",
                "next": "SECOND-DOCUMENT-6",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Anotado! Me informe agora, qual Ã© o Estado Civil dele(a)?\n1 - Solteiro(a);\n2 - Casado(a);\n3 - Divorciado(a) ou viÃºvo(a).\n(digite 1, 2 ou 3 para prosseguir).",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_MARITAL_STATUS"
                }
            },
            {
                "id": "SECOND-DOCUMENT-6",
                "name": "Save user marital status to bag.",
                "next": "SECOND-DOCUMENT-6-A-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_marital_status": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SOLTEIRO(A)' : result.activities[0].data.message === '2' ? 'CASADO(A)' : result.activities[0].data.message === '3' ? 'DIVORCIADO(A)-VIUVO(A)' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-1",
                "name": "Save on table message the bot message.",
                "next": "SECOND-DOCUMENT-6-A-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Anotado! Me informe agora, qual Ã© o Estado Civil dele(a)?\n1 - Solteiro(a);\n2 - Casado(a);\n3 - Divorciado(a) ou viÃºvo(a).\n(digite 1, 2 ou 3 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-2",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-6-A-3",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-3",
                "name": "Save messages history to bag.",
                "next": "SECOND-DOCUMENT-6-A-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-4",
                "name": "Save on table message the user response.",
                "next": "SECOND-DOCUMENT-6-A-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_marital_status"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-5",
                "name": "get chat details and messages by chat ID.",
                "next": "SECOND-DOCUMENT-6-A-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SECOND-DOCUMENT-6-A-6",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-6-A-7",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-6-A-7",
                "name": "Check marital status chosen.",
                "next": {
                    "default": "SECOND-DOCUMENT-5-A-1",
                    "CASADO(A)": "ST10-L",
                    "SOLTEIRO(A)": "DOCUMENT-6-A-8",
                    "DIVORCIADO(A)-VIUVO(A)": "ST10-L"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_marital_status"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-6-A-8",
                "name": "User send Marital Status.",
                "next": "DOCUMENT-6-A-9",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": "Bela: Ele(a) Ã© solteiro(a) com *UniÃ£o EstÃ¡vel* em cartÃ³rio?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "message"
                            ],
                            "properties": {
                                "message": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        }
                    },
                    "action": "CAPTURING_STABLE_UNION"
                }
            },
            {
                "id": "DOCUMENT-6-A-9",
                "name": "Save user union stable to bag.",
                "next": "DOCUMENT-6-A-10",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "second_user_stable_union": {
                            "$js": "({result}) => result.activities[0].data.message === '1' ? 'SIM' : result.activities[0].data.message === '2' ? 'NÃƒO' : 'OTHER'"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-6-A-10",
                "name": "Save on table message the bot message.",
                "next": "DOCUMENT-6-A-11",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": "Bela: Ele(a) Ã© solteiro(a) com *UniÃ£o EstÃ¡vel* em cartÃ³rio?\n1 - Sim;\n2 - NÃ£o.\n(digite 1 ou 2 para prosseguir).",
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-6-A-11",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-6-A-12",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-6-A-12",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-6-A-13",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-6-A-13",
                "name": "Save on table message the user response.",
                "next": "DOCUMENT-6-A-14",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.party_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$ref": "bag.second_user_stable_union"
                        },
                        "external_id": null,
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "DOCUMENT-6-A-14",
                "name": "get chat details and messages by chat ID.",
                "next": "DOCUMENT-6-A-15",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "DOCUMENT-6-A-15",
                "name": "Save messages history to bag.",
                "next": "DOCUMENT-6-A-16",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "DOCUMENT-6-A-16",
                "name": "Check union stable",
                "next": {
                    "SIM": "ST10-L",
                    "NÃƒO": "ST10-L",
                    "default": "DOCUMENT-6-A-8"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.second_user_stable_union"
                        }
                    }
                }
            },
            {
                "id": "ST10-L",
                "name": "Update request status",
                "next": "U8-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTS_RECEIVED"
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "U8-L",
                "name": "Notify that all documents were received",
                "next": "ST34-L",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}!!! O Grande passo foi dado para compra da sua Casa PrÃ³pria! Deixa eu te falar, agora nosso Time vai correr para analisar seus documentos e trazer uma resposta logo logo, ok? Obrigada!\nMe aguarde que eu nÃ£o demoro! ðŸ§¡"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_DOCUMENTS_RECEIVED",
                    "timeout": 1
                }
            },
            {
                "id": "ST34-L",
                "name": "Save message on entity message from NOTIFY_DOCUMENTS_RECEIVED.",
                "next": "ST53-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$mustache": "Bela: Muito bem, {{bag.buyer_profile.nickname}}!!! O Grande passo foi dado para compra da sua Casa PrÃ³pria! Deixa eu te falar, agora nosso Time vai correr para analisar seus documentos e trazer uma resposta logo logo, ok? Obrigada!\nMe aguarde que eu nÃ£o demoro! ðŸ§¡"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "ST53-L",
                "name": "get chat details and messages by chat ID.",
                "next": "SB25-L",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB25-L",
                "name": "Save messages history to bag.",
                "next": "PROFILE-CREDIT-INFO-1",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "PROFILE-CREDIT-INFO-1",
                "name": "Check if has a second buyer on request.",
                "next": {
                    "true": "PROFILE-CREDIT-INFO-2",
                    "default": "PROFILE-CREDIT-INFO-3"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => bag.user_second_buyer === 'SIM' || bag.user_stable_union === 'SIM' || bag.user_marital_status === 'CASADO(A)'"
                        }
                    }
                }
            },
            {
                "id": "PROFILE-CREDIT-INFO-2",
                "name": "Save profile credit info data from buyer to bag.",
                "next": "PROFILE-CREDIT-INFO-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles_credit_infos": [
                            {
                                "id": {
                                    "$js": "({bag}) => bag.buyer_profile.profiles_credit_infos ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type === 'buyer').length > 0 ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type === 'buyer')[0].id : null : null"
                                },
                                "cpf": {
                                    "$js": "({bag}) => bag.user_document_chose === 'RG' ? bag.user_cpf_native : null"
                                },
                                "native": {
                                    "$js": "({bag}) => bag.user_document_chose === 'CNH' ? bag.user_cpf_native : null"
                                },
                                "has_fgts": {
                                    "$js": "({bag}) => bag.user_fgts === 'SIM' ? true : false"
                                },
                                "fgts_value": {
                                    "$js": "({bag}) => bag.user_fgts === 'SIM' ? bag.user_fgts_value : null"
                                },
                                "profession": {
                                    "$js": "({bag}) => bag.user_proof_income === 'INFORMAL' ? bag.user_profession : null"
                                },
                                "civil_status": {
                                    "$js": "({bag}) => bag.user_marital_status.toLowerCase()"
                                },
                                "profile_type": "buyer",
                                "proof_income": {
                                    "$js": "({bag}) => bag.user_proof_income === 'SEM_RENDA' ? 'sem-renda' : bag.user_proof_income.toLowerCase()"
                                },
                                "document_type": {
                                    "$ref": "bag.user_document_chose"
                                },
                                "admission_date": {
                                    "$ref": "bag.user_proof_income_date"
                                },
                                "has_dependents": {
                                    "$js": "({bag}) => bag.user_dependents === 'SIM' ? true : false"
                                },
                                "has_stable_union": {
                                    "$js": "({bag}) => bag.user_stable_union === 'SIM' ? true : false"
                                }
                            },
                            {
                                "id": {
                                    "$js": "({bag}) => bag.buyer_profile.profiles_credit_infos ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type !== 'buyer').length > 0 ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type !== 'buyer')[0].id : null : null"
                                },
                                "cpf": {
                                    "$js": "({bag}) => bag.second_user_document_chose === 'RG' ? bag.second_user_cpf_native : null"
                                },
                                "native": {
                                    "$js": "({bag}) => bag.second_user_document_chose === 'CNH' ? bag.second_user_cpf_native : null"
                                },
                                "has_fgts": {
                                    "$js": "({bag}) => bag.second_user_fgts === 'SIM' ? true : false"
                                },
                                "fgts_value": {
                                    "$js": "({bag}) => bag.second_user_fgts === 'SIM' ? bag.second_user_fgts_value : null"
                                },
                                "profession": {
                                    "$js": "({bag}) => bag.second_user_proof_income === 'INFORMAL' ? bag.second_user_profession : null"
                                },
                                "civil_status": {
                                    "$js": "({bag}) => bag.user_stable_union === 'SIM' ? 'solteiro(a)' : bag.user_marital_status === 'CASADO(A)' ? 'casado(a)' : bag.second_user_marital_status.toLowerCase()"
                                },
                                "profile_type": {
                                    "$js": "({bag}) => bag.user_stable_union === 'SIM' ? 'union_stable' : bag.user_marital_status === 'CASADO(A)' ? 'conjuge' : 'second_buyer'"
                                },
                                "proof_income": {
                                    "$js": "({bag}) => bag.second_user_proof_income === 'SEM_RENDA' ? 'sem-renda' : bag.second_user_proof_income.toLowerCase()"
                                },
                                "document_type": {
                                    "$ref": "bag.second_user_document_chose"
                                },
                                "admission_date": {
                                    "$js": "({bag}) => bag.second_user_proof_income !== 'SEM_RENDA' ? bag.second_user_proof_income_date : null"
                                },
                                "has_dependents": {
                                    "$js": "({bag}) => bag.second_user_dependents === 'SIM' ? true : false"
                                },
                                "has_stable_union": {
                                    "$js": "({bag}) => bag.second_user_stable_union === 'SIM' ? true : false"
                                }
                            }
                        ]
                    }
                }
            },
            {
                "id": "PROFILE-CREDIT-INFO-3",
                "name": "Save profile credit info data from buyer to bag.",
                "next": "PROFILE-CREDIT-INFO-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles_credit_infos": [
                            {
                                "id": {
                                    "$js": "({bag}) => bag.buyer_profile.profiles_credit_infos ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type === 'buyer').length > 0 ? bag.buyer_profile.profiles_credit_infos.filter((profile) => profile.profile_type === 'buyer')[0].id : null : null"
                                },
                                "cpf": {
                                    "$js": "({bag}) => bag.user_document_chose === 'RG' ? bag.user_cpf_native : null"
                                },
                                "native": {
                                    "$js": "({bag}) => bag.user_document_chose === 'CNH' ? bag.user_cpf_native : null"
                                },
                                "has_fgts": {
                                    "$js": "({bag}) => bag.user_fgts === 'SIM' ? true : false"
                                },
                                "fgts_value": {
                                    "$js": "({bag}) => bag.user_fgts === 'SIM' ? bag.user_fgts_value : null"
                                },
                                "profession": {
                                    "$js": "({bag}) => bag.user_proof_income === 'INFORMAL' ? bag.user_profession : null"
                                },
                                "civil_status": {
                                    "$js": "({bag}) => bag.user_marital_status.toLowerCase()"
                                },
                                "profile_type": "buyer",
                                "proof_income": {
                                    "$js": "({bag}) => bag.user_proof_income === 'SEM_RENDA' ? 'sem-renda' : bag.user_proof_income.toLowerCase()"
                                },
                                "document_type": {
                                    "$ref": "bag.user_document_chose"
                                },
                                "admission_date": {
                                    "$ref": "bag.user_proof_income_date"
                                },
                                "has_dependents": {
                                    "$js": "({bag}) => bag.user_dependents === 'SIM' ? true : false"
                                },
                                "has_stable_union": {
                                    "$js": "({bag}) => bag.user_stable_union === 'SIM' ? true : false"
                                }
                            }
                        ]
                    }
                }
            },
            {
                "id": "PROFILE-CREDIT-INFO-4",
                "name": "Update Profile with credit infos",
                "next": "ST11-B",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profiles_credit_infos": {
                            "$ref": "bag.profiles_credit_infos"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/profiles/{{bag.buyer_profile.id}}"
                        },
                        "verb": "PUT",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "ST11-B",
                "name": "Get request details",
                "next": "SB5-B",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/{{bag.request.id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SB5-B",
                "name": "Set request details to bag",
                "next": "U9-B",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request_details": {
                            "$ref": "result.data"
                        }
                    }
                }
            },
            {
                "id": "U9-B",
                "name": "Backoffice request analysis",
                "next": "SB7-B",
                "type": "UserTask",
                "lane_id": "B",
                "parameters": {
                    "input": {
                        "request": {
                            "$ref": "bag.request_details"
                        },
                        "activity_schema": {
                            "type": "object",
                            "required": [
                                "action"
                            ],
                            "properties": {
                                "type": {
                                    "type": "string"
                                },
                                "action": {
                                    "type": "string"
                                },
                                "message": {
                                    "type": "string"
                                },
                                "credit_limit": {
                                    "type": "string"
                                },
                                "proof_status": {
                                    "type": "string"
                                },
                                "attachment_id": {
                                    "type": "string"
                                }
                            },
                            "additionalProperties": false
                        },
                        "client_mobile_phone": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "REQUEST_ANALYSIS"
                }
            },
            {
                "id": "SB7-B",
                "name": "Set activity content to bag",
                "next": "F4-B",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "type": {
                            "$ref": "result.activities[0].data.type"
                        },
                        "action": {
                            "$ref": "result.activities[0].data.action"
                        },
                        "message": {
                            "$ref": "result.activities[0].data.message"
                        },
                        "credit_limit": {
                            "$ref": "result.activities[0].data.credit_limit"
                        },
                        "proof_status": {
                            "$ref": "result.activities[0].data.proof_status"
                        },
                        "attachment_id": {
                            "$ref": "result.activities[0].data.attachment_id"
                        }
                    }
                }
            },
            {
                "id": "F4-B",
                "name": "Check Backoffice action",
                "next": {
                    "default": "REJECT-REQUEST-1",
                    "approve_request": "FINISH-REQUEST-1",
                    "classify_documents": "CLASSIFY-DOCUMENT-1",
                    "request_new_documents": "REVIEW-DOCUMENT-1",
                    "notify_documents_review": "APPROVE-DOCUMENT-1"
                },
                "type": "Flow",
                "lane_id": "B",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.action"
                        }
                    }
                }
            },
            {
                "id": "APPROVE-DOCUMENT-1",
                "name": "Set to bag notify_documents_review",
                "next": "APPROVE-DOCUMENT-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "notify_documents_review": true
                    }
                }
            },
            {
                "id": "APPROVE-DOCUMENT-2",
                "name": "Update request status to DOCUMENTS_APPROVED",
                "next": "U9-B",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTS_APPROVED"
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "REVIEW-DOCUMENT-1",
                "name": "Update request status to REJECTED",
                "next": "REVIEW-DOCUMENT-2",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTS_REJECTED"
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "REVIEW-DOCUMENT-2",
                "name": "Notify request documents again",
                "next": "REVIEW-DOCUMENT-3",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => 'Bela: ' + bag.message"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_REQUEST_DOCUMENTS_AGAIN",
                    "timeout": 1
                }
            },
            {
                "id": "REVIEW-DOCUMENT-3",
                "name": "Save message on entity message from NOTIFY_REQUEST_DOCUMENTS_AGAIN",
                "next": "REVIEW-DOCUMENT-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "content": {
                            "$js": "({bag}) => 'Bela: ' + bag.message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "REVIEW-DOCUMENT-4",
                "name": "get chat details and messages by chat ID.",
                "next": "REVIEW-DOCUMENT-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "REVIEW-DOCUMENT-5",
                "name": "Save messages history to bag.",
                "next": "REVIEW-DOCUMENT-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "REVIEW-DOCUMENT-6",
                "name": "Start sub process to review documents.",
                "next": "ST10-L",
                "type": "SubProcess",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "bot_phone_number": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "buyer_profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "chat_participant_id": {
                            "$ref": "bag.buyer_chat_participant_id"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "documentReview",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CLASSIFY-DOCUMENT-1",
                "name": "Update attachments",
                "next": "CLASSIFY-DOCUMENT-2",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "type": {
                            "$ref": "bag.type"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/attachments?id=eq.{{bag.attachment_id}}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CLASSIFY-DOCUMENT-2",
                "name": "Update proofs",
                "next": "CLASSIFY-DOCUMENT-3",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": {
                            "$ref": "bag.proof_status"
                        },
                        "approved_by_actor_id": {
                            "$ref": "actor_data.actor_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/proofs?attachment_id=eq.{{bag.attachment_id}}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CLASSIFY-DOCUMENT-3",
                "name": "Get backoffice data",
                "next": "CLASSIFY-DOCUMENT-4",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/profiles?actor_id=eq.{{actor_data.actor_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "CLASSIFY-DOCUMENT-4",
                "name": "Save the user's name to make last analisy documents to bag.",
                "next": "CLASSIFY-DOCUMENT-5",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "last_analysis_by": {
                            "$ref": "result.data[0].name"
                        }
                    }
                }
            },
            {
                "id": "CLASSIFY-DOCUMENT-5",
                "name": "Update request status to DOCUMENTS_ANALYSIS",
                "next": "ST11-B",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTS_ANALYSIS"
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://postgrest:3000/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-1",
                "name": "Approve Request",
                "next": "FINISH-REQUEST-2",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "credit_limit": {
                            "$ref": "bag.credit_limit"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/approve"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-2",
                "name": "create a new chat with type REALTOR.",
                "next": "FINISH-REQUEST-3",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "chat_type": "REALTOR",
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "buyer_profile_id": {
                            "$ref": "bag.buyer_profile.id"
                        },
                        "realtor_profile_id": {
                            "$ref": "bag.request_details.realtor.id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-3",
                "name": "Set chat details to bag",
                "next": "FINISH-REQUEST-4",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "result.data.chat_id"
                        },
                        "chat_bot_id": {
                            "$ref": "bag.chat_id"
                        },
                        "buyer_chat_participant_id": {
                            "$ref": "result.data.buyer_chat_participant_id"
                        },
                        "realtor_chat_participant_id": {
                            "$ref": "result.data.realtor_chat_participant_id"
                        }
                    }
                }
            },
            {
                "id": "REJECT-REQUEST-1",
                "name": "Reject Request",
                "next": "FINISH-REQUEST-4",
                "type": "SystemTask",
                "lane_id": "B",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "request_id": {
                            "$ref": "bag.request.id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/requests/reject"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-4",
                "name": "Notify user of request analysis result",
                "next": "FINISH-REQUEST-5",
                "type": "UserTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "message": {
                            "$js": "({bag}) => 'Bela: ' + bag.message"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_REQUEST_ANALYSIS_RESULT",
                    "timeout": 1
                }
            },
            {
                "id": "FINISH-REQUEST-5",
                "name": "Save message on entity message from NOTIFY_REQUEST_ANALYSIS_RESULT.",
                "next": "FINISH-REQUEST-6",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        },
                        "chat_id": {
                            "$ref": "bag.chat_bot_id"
                        },
                        "content": {
                            "$js": "({bag}) => 'Bela: ' + bag.message"
                        },
                        "external_id": null,
                        "chat_participant_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/messages"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204,
                        400
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-6",
                "name": "Check if chat_bot_id was defined.",
                "next": {
                    "false": "FINISH-REQUEST-8",
                    "default": "FINISH-REQUEST-7"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({bag}) => (!!bag.chat_bot_id)"
                        }
                    }
                }
            },
            {
                "id": "FINISH-REQUEST-7",
                "name": "get chat details and messages by chat ID.",
                "next": "FINISH-REQUEST-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_bot_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-8",
                "name": "get chat details and messages by chat ID.",
                "next": "FINISH-REQUEST-9",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "http://aprova_services:3000/rpc/chat/{{bag.chat_id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "FINISH-REQUEST-9",
                "name": "Save messages history to bag.",
                "next": "FINISH-REQUEST-10",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "messages": {
                            "$ref": "result.data.messages"
                        }
                    }
                }
            },
            {
                "id": "FINISH-REQUEST-10",
                "name": "Get bot data",
                "next": "FINISH-REQUEST-11",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "GetBotDataTask",
                "parameters": {
                    "input": {
                        "actor": {
                            "$ref": "bag.bot_phone_number"
                        }
                    }
                }
            },
            {
                "id": "FINISH-REQUEST-11",
                "name": "Check request was approved.",
                "next": {
                    "default": "EXIT-REQUEST-ANALYSIS-RESULT",
                    "approve_request": "FINISH-REQUEST-12"
                },
                "type": "Flow",
                "lane_id": "BOT_X_BACKOFFICE",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.action"
                        }
                    }
                }
            },
            {
                "id": "FINISH-REQUEST-12",
                "name": "Start realtorChat workflow.",
                "next": "EXIT-REQUEST-ANALYSIS-RESULT",
                "type": "SystemTask",
                "lane_id": "BOT_X_BACKOFFICE",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        }
                    },
                    "actor_data": {
                        "$ref": "result"
                    },
                    "workflow_name": "realtorChat"
                }
            },
            {
                "id": "EXIT-REQUEST-ANALYSIS-RESULT",
                "name": "Finish node",
                "next": null,
                "type": "Finish",
                "lane_id": "BOT_X_BACKOFFICE"
            }
        ],
        "prepare": [],
        "environment": {},
        "requirements": [
            "core"
        ]
    }
}